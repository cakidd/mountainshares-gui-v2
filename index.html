        // MountainShares accurate fee formula implementation
        const MOUNTAINSHARES_PRICING = {
            TOKEN_BASE_PRICE: 1.00
        };

        function calculateProcessingFees(tokenPrice) {
            // Platform Fee: X(2% + $0.03)
            const platformFee = Math.round((tokenPrice * 0.02 + 0.03) * 100) / 100;
            
            // Additional Processing: X(0.5%) rounded to nearest penny
            const additionalProcessing = Math.round((tokenPrice * 0.005) * 100) / 100;
            
            // Stripe Processing: X(2.9% + $0.30) rounded to nearest penny
            const stripeProcessing = Math.round((tokenPrice * 0.029 + 0.30) * 100) / 100;
            
            // Hidden Stripe SEC regulatory fees: $0.01
            const hiddenSECFees = 0.01;
            
            return platformFee + additionalProcessing + stripeProcessing + hiddenSECFees;
        }

        function calculateTotalAmount(tokenPrice, quantity) {
            const subtotal = tokenPrice * quantity;
            const processingFees = calculateProcessingFees(tokenPrice) * quantity;
            return subtotal + processingFees;
        }

        function updatePurchaseSummary() {
            const quantity = parseInt(document.getElementById('tokenQuantity').value) || 1;
            const tokenPrice = MOUNTAINSHARES_PRICING.TOKEN_BASE_PRICE;
            const subtotal = tokenPrice * quantity;
            const processingFees = calculateProcessingFees(tokenPrice) * quantity;
            const totalAmount = calculateTotalAmount(tokenPrice, quantity);
            
            // Update display
            document.getElementById('tokenPrice').textContent = `$${tokenPrice.toFixed(2)}`;
            document.getElementById('quantity').textContent = quantity;
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('processingFees').textContent = `$${processingFees.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `$${totalAmount.toFixed(2)}`;
            
            console.log('MountainShares pricing updated:', {
                quantity: quantity,
                tokenPrice: tokenPrice,
                subtotal: subtotal,
                processingFees: processingFees,
                totalAmount: totalAmount
            });
        }

        async function purchaseTokens() {
            console.log('üèîÔ∏è Initiating MountainShares token purchase...');
            
            const quantity = parseInt(document.getElementById('tokenQuantity').value) || 1;
            const tokenPrice = MOUNTAINSHARES_PRICING.TOKEN_BASE_PRICE;
            const totalAmount = calculateTotalAmount(tokenPrice, quantity);
            
            console.log(`üí∞ Purchase: ${quantity} tokens for $${totalAmount.toFixed(2)}`);
            
            const button = document.querySelector('.purchase-tokens');
            const originalText = button.textContent;
            
            button.textContent = 'Processing Purchase...';
            button.disabled = true;
            
            try {
                const response = await fetch('/netlify/functions/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        quantity: quantity,
                        totalAmount: totalAmount,
                        tokenPrice: tokenPrice,
                        processingFees: calculateProcessingFees(tokenPrice) * quantity,
                        platform: 'MountainShares',
                        community: 'Mount Hope, WV'
                    })
                });
                
                const session = await response.json();
                
                if (session.error) {
                    throw new Error(session.error);
                }
                
                window.location.href = session.url;
                
            } catch (error) {
                console.error('‚ùå Purchase failed:', error);
                alert(`Purchase failed: ${error.message}`);
                
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePurchaseSummary();
            console.log('üèîÔ∏è MountainShares platform initialized');
            console.log('üí∞ Formula: 2% + $0.03 + 0.5% + 2.9% + $0.30 + $0.01 SEC = $0.40 processing');
        });
