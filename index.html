<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MountainShares - Premium Token Investment Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            color: #667eea;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .price-display {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .current-price {
            color: #667eea;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .token-input {
            margin-bottom: 30px;
        }
        
        .token-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .token-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .token-input input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .purchase-summary {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .purchase-summary h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3rem;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
            color: #666;
        }
        
        .summary-item.total {
            border-top: 2px solid #667eea;
            padding-top: 15px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.2rem;
            color: #333;
        }
        
        .summary-item.total .amount {
            color: #667eea;
            font-size: 1.4rem;
        }
        
        .button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .connect-wallet {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .connect-wallet:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .purchase-tokens {
            background: #6c757d;
            color: white;
        }
        
        .purchase-tokens:hover {
            background: #5a6268;
        }
        
        .processing-fee-note {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üèîÔ∏è MountainShares</div>
            <div class="subtitle">Premium Token Investment Platform</div>
        </div>
        
        <div class="price-display">
            <div class="current-price">Current Price: $1.40 per token</div>
        </div>
        
        <div class="token-input">
            <label for="tokenQuantity">Number of Tokens:</label>
            <input type="number" id="tokenQuantity" value="1" min="1" max="1000" onchange="updatePurchaseSummary()">
        </div>
        
        <div class="purchase-summary">
            <h3>Purchase Summary</h3>
            <div class="summary-item">
                <span>Token Price:</span>
                <span id="tokenPrice">$1.00</span>
            </div>
            <div class="summary-item">
                <span>Quantity:</span>
                <span id="quantity">1</span>
            </div>
            <div class="summary-item">
                <span>Subtotal:</span>
                <span id="subtotal">$1.00</span>
            </div>
            <div class="summary-item">
                <span>Processing Fees:</span>
                <span id="processingFees">$0.40</span>
            </div>
            <div class="summary-item total">
                <span>Total Amount:</span>
                <span class="amount" id="totalAmount">$1.40</span>
            </div>
        </div>
        
        <button class="button connect-wallet" onclick="connectWallet()">Connect Wallet</button>
        <button class="button purchase-tokens" onclick="purchaseTokens()">Purchase Tokens</button>
        
        <div class="processing-fee-note">
            Processing fees include platform fee (2% + $0.03), additional processing (0.5%), Stripe processing (2.9% + $0.30), and SEC regulatory fees ($0.01)
        </div>
    </div>

    <script>
        // MountainShares Fee Formula Implementation
        const MOUNTAINSHARES_PRICING = {
            TOKEN_BASE_PRICE: 1.00
        };

        function calculateProcessingFees(tokenPrice) {
            // Platform Fee: X(2% + $0.03) = $0.05
            const platformFee = Math.round((tokenPrice * 0.02 + 0.03) * 100) / 100;
            
            // Additional Processing: X(0.5%) rounded to nearest penny = $0.01
            const additionalProcessing = Math.round((tokenPrice * 0.005) * 100) / 100;
            
            // Stripe Processing: X(2.9% + $0.30) rounded to nearest penny = $0.33
            const stripeProcessing = Math.round((tokenPrice * 0.029 + 0.30) * 100) / 100;
            
            // Hidden Stripe SEC regulatory fees = $0.01
            const hiddenSECFees = 0.01;
            
            return platformFee + additionalProcessing + stripeProcessing + hiddenSECFees;
        }

        function updatePurchaseSummary() {
            const quantity = parseInt(document.getElementById('tokenQuantity').value) || 1;
            const tokenPrice = MOUNTAINSHARES_PRICING.TOKEN_BASE_PRICE;
            const subtotal = tokenPrice * quantity;
            const processingFees = calculateProcessingFees(tokenPrice) * quantity;
            const totalAmount = subtotal + processingFees;
            
            // Update display elements
            document.getElementById('tokenPrice').textContent = `$${tokenPrice.toFixed(2)}`;
            document.getElementById('quantity').textContent = quantity;
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('processingFees').textContent = `$${processingFees.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `$${totalAmount.toFixed(2)}`;
            
            // Update header price display
            const priceDisplay = document.querySelector('.current-price');
            if (priceDisplay) {
                priceDisplay.textContent = `Current Price: $${totalAmount.toFixed(2)} per token`;
            }
            
            console.log('MountainShares pricing updated:', {
                quantity: quantity,
                tokenPrice: tokenPrice,
                subtotal: subtotal,
                processingFees: processingFees,
                totalAmount: totalAmount
            });
        }

        function connectWallet() {
            console.log('üîó Connecting wallet for MountainShares...');
            
            const button = document.querySelector('.connect-wallet');
            button.textContent = 'Wallet Connected ‚úì';
            button.style.background = '#28a745';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = 'Connect Wallet';
                button.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                button.disabled = false;
            }, 3000);
        }

        async function purchaseTokens() {
            console.log('üèîÔ∏è Initiating MountainShares token purchase...');
            
            const quantity = parseInt(document.getElementById('tokenQuantity').value) || 1;
            const tokenPrice = MOUNTAINSHARES_PRICING.TOKEN_BASE_PRICE;
            const processingFees = calculateProcessingFees(tokenPrice) * quantity;
            const totalAmount = (tokenPrice * quantity) + processingFees;
            
            console.log(`üí∞ Purchase: ${quantity} tokens for $${totalAmount.toFixed(2)}`);
            
            const button = document.querySelector('.purchase-tokens');
            const originalText = button.textContent;
            
            button.textContent = 'Processing Purchase...';
            button.disabled = true;
            
            try {
                const response = await fetch('/netlify/functions/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        quantity: quantity,
                        totalAmount: totalAmount,
                        tokenPrice: tokenPrice,
                        processingFees: processingFees,
                        platform: 'MountainShares',
                        community: 'Mount Hope, WV'
                    })
                });
                
                const session = await response.json();
                
                if (session.error) {
                    throw new Error(session.error);
                }
                
                window.location.href = session.url;
                
            } catch (error) {
                console.error('‚ùå Purchase failed:', error);
                alert(`Purchase failed: ${error.message}`);
                
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePurchaseSummary();
            
            // Bind quantity input changes
            const quantityInput = document.getElementById('tokenQuantity');
            if (quantityInput) {
                quantityInput.addEventListener('input', updatePurchaseSummary);
            }
            
            console.log('üèîÔ∏è MountainShares platform initialized');
            console.log('üí∞ Fee formula: 2% + $0.03 + 0.5% + 2.9% + $0.30 + $0.01 = $0.40');
        });
    </script>
</body>
</html>
