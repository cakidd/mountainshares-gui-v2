<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MountainShares Purchase - West Virginia Digital Currency</title>
    <meta name="description" content="Purchase MountainShares digital currency for West Virginia communities. 1 MountainShare = $1.00 + fees ($1.37 total)">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèîÔ∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --wv-gold: #FFD700;
            --mountain-blue: #0066FF;
            --sky-blue: #00BFFF;
            --deep-black: #000000;
            --mountain-dark: #0A0A0A;
            --stone-gray: #1A1A1A;
            --mountain-white: #FFFFFF;
            --wv-mountain-green: #228B22;
            --appalachian-brown: #8B4513;
            --holographic: linear-gradient(45deg, #FFD700, #0066FF, #00BFFF, #FFD700);
            --wv-gradient: linear-gradient(135deg, #FFD700, #0066FF, #00BFFF);
            --mountain-gradient: linear-gradient(45deg, #000000, #001122, #0066FF);
            --gold-gradient: linear-gradient(135deg, #FFD700, #FFA500, #FF6B35);
            --glass-gradient: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(0, 102, 255, 0.05));
            --shadow-glow: 0 0 50px rgba(255, 215, 0, 0.6), 0 0 100px rgba(0, 102, 255, 0.4);
            --text-glow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: var(--mountain-dark);
            color: var(--mountain-white);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* DYNAMIC HOLOGRAPHIC BACKGROUND WITH WV COLORS */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 102, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 191, 255, 0.1) 0%, transparent 50%),
                conic-gradient(from 0deg at 50% 50%, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: holographicPulse 15s ease-in-out infinite;
            z-index: -2;
        }

        /* ANIMATED MESH GRADIENT WITH WV COLORS */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(45deg, transparent 30%, rgba(255, 215, 0, 0.05) 50%, transparent 70%),
                linear-gradient(-45deg, transparent 30%, rgba(0, 102, 255, 0.05) 50%, transparent 70%);
            animation: meshMove 20s linear infinite;
            z-index: -1;
        }

        @keyframes holographicPulse {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1) rotate(0deg);
            }
            25% {
                opacity: 1;
                transform: scale(1.05) rotate(2deg);
            }
            50% {
                opacity: 0.9;
                transform: scale(1.1) rotate(-1deg);
            }
            75% {
                opacity: 1;
                transform: scale(1.02) rotate(1deg);
            }
        }

        @keyframes meshMove {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 40px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(30px);
            min-height: 100vh;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-glow);
        }

        .header {
            text-align: center;
            margin-bottom: 80px;
            position: relative;
        }

        /* REVOLUTIONARY 3D HOLOGRAPHIC LOGO */
        .header::before {
            content: 'üèîÔ∏è';
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 80px;
            background: var(--wv-gradient);
            border-radius: 25px;
            padding: 20px;
            box-shadow:
                0 0 60px rgba(255, 215, 0, 0.8),
                inset 0 0 60px rgba(255, 255, 255, 0.2);
            animation: logoFloat 8s ease-in-out infinite;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes logoFloat {
            0%, 100% {
                transform: translateX(-50%) translateY(0) rotateY(0deg) rotateX(0deg) scale(1);
            }
            25% {
                transform: translateX(-50%) translateY(-10px) rotateY(15deg) rotateX(5deg) scale(1.05);
            }
            50% {
                transform: translateX(-50%) translateY(-5px) rotateY(0deg) rotateX(-5deg) scale(1.02);
            }
            75% {
                transform: translateX(-50%) translateY(-15px) rotateY(-15deg) rotateX(5deg) scale(1.05);
            }
        }

        .header h1 {
            font-family: 'Orbitron', monospace;
            font-size: 64px;
            font-weight: 900;
            background: var(--wv-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            margin-top: 60px;
            text-shadow: var(--text-glow);
            animation: titlePulse 6s ease-in-out infinite;
            position: relative;
        }

        .header h1::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--wv-gradient);
            animation: underlineGlow 4s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% {
                filter: brightness(1) saturate(1) hue-rotate(0deg);
                transform: scale(1);
            }
            50% {
                filter: brightness(1.3) saturate(1.5) hue-rotate(15deg);
                transform: scale(1.02);
            }
        }

        @keyframes underlineGlow {
            0%, 100% {
                opacity: 0.7;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            }
            50% {
                opacity: 1;
                box-shadow: 0 0 40px rgba(0, 102, 255, 0.8);
            }
        }

        .header p {
            font-size: 24px;
            color: var(--sky-blue);
            opacity: 0.9;
            text-shadow: 0 0 15px rgba(0, 191, 255, 0.8);
            animation: taglineGlow 3s ease-in-out infinite;
        }

        @keyframes taglineGlow {
            0%, 100% {
                opacity: 0.8;
                text-shadow: 0 0 15px rgba(0, 191, 255, 0.8);
            }
            50% {
                opacity: 1;
                text-shadow: 0 0 30px rgba(0, 191, 255, 1);
            }
        }

        .purchase-section {
            background: var(--glass-gradient);
            backdrop-filter: blur(40px);
            border-radius: 40px;
            padding: 60px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow:
                var(--shadow-glow),
                inset 0 0 80px rgba(255, 255, 255, 0.1);
            margin-bottom: 80px;
            position: relative;
            overflow: hidden;
        }

        .purchase-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: var(--holographic);
            opacity: 0.1;
            animation: heroRotate 20s linear infinite;
        }

        .purchase-section::after {
            content: '';
            position: absolute;
            inset: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 35px;
            pointer-events: none;
            animation: heroBorder 8s ease-in-out infinite;
        }

        @keyframes heroRotate {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(360deg) scale(1.1); }
        }

        @keyframes heroBorder {
            0%, 100% {
                border-color: rgba(255, 215, 0, 0.3);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            }
            50% {
                border-color: rgba(0, 255, 255, 0.5);
                box-shadow: 0 0 40px rgba(0, 255, 255, 0.4);
            }
        }

        .purchase-form {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 3;
        }

        .wallet-section {
            margin-bottom: 40px;
        }

        /* REVOLUTIONARY BUTTON DESIGN */
        .wallet-button, .purchase-button {
            padding: 28px 56px;
            border: 2px solid transparent;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 800;
            font-size: 20px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            min-width: 300px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-family: 'Orbitron', monospace;
            transform-style: preserve-3d;
            background: var(--gold-gradient);
            color: var(--mountain-dark);
            border-color: var(--wv-gold);
            box-shadow: 0 15px 50px rgba(255, 215, 0, 0.5);
            margin-bottom: 25px;
        }

        .wallet-button::before, .purchase-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: all 0.5s ease;
        }

        .wallet-button:hover::before, .purchase-button:hover::before {
            left: 100%;
        }

        .wallet-button:hover, .purchase-button:hover {
            transform: translateY(-10px) scale(1.05) rotateX(15deg);
            box-shadow:
                0 25px 80px rgba(255, 215, 0, 0.6),
                0 0 60px rgba(0, 255, 255, 0.4),
                inset 0 0 40px rgba(255, 255, 255, 0.2);
        }

        .wallet-address {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            word-break: break-all;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .purchase-controls {
            margin: 40px 0;
        }

        .purchase-controls label {
            display: block;
            color: var(--mountain-white);
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: var(--text-glow);
        }

        .quantity-input {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            color: var(--mountain-white);
            font-size: 22px;
            text-align: center;
            width: 300px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .quantity-input:focus {
            outline: none;
            border-color: var(--wv-gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        .price-display {
            background: var(--glass-gradient);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 18px;
            color: var(--mountain-white);
        }

        .total-row {
            border-top: 2px solid rgba(255, 215, 0, 0.5);
            padding-top: 20px;
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
            color: var(--wv-gold);
            text-shadow: var(--text-glow);
        }

        .purchase-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .purchase-button:disabled:hover {
            transform: none;
            box-shadow: 0 15px 50px rgba(255, 215, 0, 0.5);
        }

        /* FLOATING CARDS WITH GLASSMORPHISM */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            margin-top: 80px;
        }

        .info-card {
            background: var(--glass-gradient);
            backdrop-filter: blur(30px);
            padding: 40px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--wv-gradient);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .info-card:hover {
            transform: translateY(-15px) rotateX(10deg);
            box-shadow:
                0 30px 80px rgba(255, 215, 0, 0.4),
                0 0 60px rgba(0, 102, 255, 0.3);
        }

        .info-card:hover::before {
            transform: translateX(0);
        }

        .info-card h3 {
            color: var(--wv-gold);
            font-size: 28px;
            margin-bottom: 20px;
            font-family: 'Orbitron', monospace;
            text-shadow: var(--text-glow);
        }

        .info-card p {
            color: var(--mountain-white);
            line-height: 1.7;
            font-size: 16px;
            opacity: 0.9;
        }

        .footer {
            text-align: center;
            padding: 60px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 80px;
        }

        .footer p {
            color: var(--sky-blue);
            opacity: 0.8;
            font-size: 18px;
            text-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
        }

        /* FLOATING PARTICLES */
        .particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: var(--wv-gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            animation: particleFloat 15s linear infinite;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg) scale(0);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 20px;
            }

            .header h1 {
                font-size: 42px;
            }

            .purchase-section {
                padding: 30px;
            }

            .quantity-input {
                width: 100%;
                max-width: 300px;
            }

            .price-row {
                font-size: 16px;
            }

            .total-row {
                font-size: 20px;
            }

            .wallet-button, .purchase-button {
                width: 100%;
                max-width: 400px;
                padding: 20px 40px;
                font-size: 16px;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="header">
            <h1>üèîÔ∏è MountainShares Purchase</h1>
            <p>Digital currency for West Virginia communities ‚Ä¢ 1 MountainShare = $1.00 + fees ($1.37 total)</p>
        </header>

        <main>
            <section class="purchase-section">
                <div class="purchase-form">
                    <div class="wallet-section">
                        <button id="connectWallet" class="wallet-button">
                            ü¶ä Connect MetaMask Wallet
                        </button>
                        <div id="walletAddress" class="wallet-address" style="display: none;"></div>
                    </div>

                    <div class="purchase-controls">
                        <label for="quantity">Number of MountainShares:</label>
                        <input type="number" id="quantity" class="quantity-input" min="1" value="1" placeholder="1">
                    </div>

                    <div class="price-display">
                        <div class="price-row">
                            <span>MountainShares:</span>
                            <span id="tokenCount">1</span>
                        </div>
                        <div class="price-row">
                            <span>Token Value ($1.00 each):</span>
                            <span id="tokenValue">$1.00</span>
                        </div>
                        <div class="price-row">
                            <span>Platform Fee (2%):</span>
                            <span id="platformFee">$0.02</span>
                        </div>
                        <div class="price-row">
                            <span>Processing Fee (0.05%):</span>
                            <span id="processingFee">$0.01</span>
                        </div>
                        <div class="price-row">
                            <span>Stripe + SEC Fee (2.9% + $0.30):</span>
                            <span id="stripeFee">$0.34</span>
                        </div>
                        <div class="price-row total-row">
                            <span>Total Amount:</span>
                            <span id="totalAmount">$1.37</span>
                        </div>
                    </div>

                    <button id="purchaseButton" class="purchase-button" disabled>
                        üíé Purchase MountainShares
                    </button>
                </div>
            </section>

            <div class="info-grid">
                <div class="info-card">
                    <h3>üíé What are MountainShares?</h3>
                    <p>Local digital currency that keeps money in West Virginia communities. Each MountainShare costs $1.00 plus processing fees ($1.37 total) and supports local economic growth.</p>
                </div>

                <div class="info-card">
                    <h3>üîí Secure & Safe</h3>
                    <p>Your purchase is processed securely through Stripe with bank-level encryption. Your MetaMask wallet ensures safe token delivery.</p>
                </div>

                <div class="info-card">
                    <h3>üèîÔ∏è Support Local Economy</h3>
                    <p>Every MountainShare purchase supports West Virginia's local economy by keeping money circulating within our mountain communities.</p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>¬© 2025 MountainShares ‚Ä¢ West Virginia Digital Business Network</p>
        </footer>
    </div>

    <script>
        // MountainShares Purchase Component JavaScript
        let connectedWallet = null;

        // Connect MetaMask wallet
        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    connectedWallet = accounts[0];

                    document.getElementById('connectWallet').textContent = '‚úÖ Wallet Connected';
                    document.getElementById('walletAddress').style.display = 'block';
                    document.getElementById('walletAddress').textContent = `Connected: ${connectedWallet}`;
                    document.getElementById('purchaseButton').disabled = false;

                    console.log('ü¶ä MetaMask wallet connected:', connectedWallet);
                } else {
                    alert('MetaMask is not installed. Please install MetaMask to continue.');
                }
            } catch (error) {
                console.error('Failed to connect wallet:', error);
                alert('Failed to connect wallet. Please try again.');
            }
        }

        // Calculate pricing with correct MountainShares fee structure
        function calculatePrice() {
            const quantity = parseInt(document.getElementById('quantity').value) || 1;

            // Correct pricing structure: $1.00 base + fees = $1.37 total
            const baseTokenPrice = 1.00;
            const platformFeeRate = 0.02; // 2%
            const processingFeeRate = 0.0005; // 0.05%
            const stripeFeeRate = 0.029; // 2.9%
            const stripeFixedFee = 0.30; // $0.30 fixed fee

            // Calculate fees per token
            const platformFeePerToken = baseTokenPrice * platformFeeRate; // $0.02
            const processingFeePerToken = Math.round(baseTokenPrice * processingFeeRate * 100) / 100; // $0.01 (rounded)
            const stripeFeePerToken = Math.round((baseTokenPrice * stripeFeeRate + stripeFixedFee) * 100) / 100; // $0.34 (includes SEC fee)

            // Calculate totals for quantity
            const tokenValue = baseTokenPrice * quantity;
            const platformFee = platformFeePerToken * quantity;
            const processingFee = processingFeePerToken * quantity;
            const stripeFee = stripeFeePerToken * quantity;
            const totalAmount = tokenValue + platformFee + processingFee + stripeFee;

            // Update display
            document.getElementById('tokenCount').textContent = quantity;
            document.getElementById('tokenValue').textContent = `$${tokenValue.toFixed(2)}`;
            document.getElementById('platformFee').textContent = `$${platformFee.toFixed(2)}`;
            document.getElementById('processingFee').textContent = `$${processingFee.toFixed(2)}`;
            document.getElementById('stripeFee').textContent = `$${stripeFee.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `$${totalAmount.toFixed(2)}`;

            return {
                quantity,
                baseTokenPrice,
                tokenValue,
                platformFee,
                processingFee,
                stripeFee,
                totalAmount
            };
        }

        // Show status messages
        function showStatus(message, type = 'info') {
            // Create or get status display
            let statusDiv = document.getElementById('purchase-status');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'purchase-status';
                statusDiv.style.cssText = `
                    margin-top: 25px;
                    padding: 20px;
                    border-radius: 15px;
                    text-align: center;
                    font-weight: bold;
                    backdrop-filter: blur(20px);
                    border: 2px solid;
                    animation: statusSlideIn 0.5s ease;
                `;
                document.querySelector('.purchase-form').appendChild(statusDiv);
            }

            statusDiv.textContent = message;
            statusDiv.style.display = 'block';

            // Style based on type
            if (type === 'success') {
                statusDiv.style.background = 'rgba(0, 255, 136, 0.1)';
                statusDiv.style.borderColor = '#00FF88';
                statusDiv.style.color = '#00FF88';
            } else if (type === 'error') {
                statusDiv.style.background = 'rgba(255, 68, 68, 0.1)';
                statusDiv.style.borderColor = '#FF4444';
                statusDiv.style.color = '#FF4444';
            } else if (type === 'warning') {
                statusDiv.style.background = 'rgba(255, 170, 0, 0.1)';
                statusDiv.style.borderColor = '#FFAA00';
                statusDiv.style.color = '#FFAA00';
            } else {
                statusDiv.style.background = 'rgba(0, 191, 255, 0.1)';
                statusDiv.style.borderColor = '#00BFFF';
                statusDiv.style.color = '#00BFFF';
            }

            // Auto-hide after 8 seconds unless it's an error
            if (type !== 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 8000);
            }
        }

        // Initiate purchase with CORS error handling
        async function initiatePurchase() {
            try {
                if (!connectedWallet) {
                    showStatus('‚ö†Ô∏è Please connect your MetaMask wallet first', 'warning');
                    return;
                }

                const pricing = calculatePrice();
                
                showStatus('üöÄ Initiating purchase...', 'info');

                // Try primary API endpoint
                const response = await fetch('https://mountainshares-gui-v2-chhnclt56-mountainshares-team.vercel.app/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        quantity: pricing.quantity,
                        walletAddress: connectedWallet,
                        baseTokenPrice: pricing.baseTokenPrice,
                        tokenValue: pricing.tokenValue,
                        platformFee: pricing.platformFee,
                        processingFee: pricing.processingFee,
                        stripeFee: pricing.stripeFee,
                        totalAmount: pricing.totalAmount
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const session = await response.json();

                showStatus('‚úÖ Redirecting to secure checkout...', 'success');
                
                // Redirect to Stripe checkout
                setTimeout(() => {
                    window.location.href = session.url;
                }, 1500);

            } catch (error) {
                console.error('Purchase initiation failed:', error);
                
                if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
                    // CORS error detected
                    showStatus(`üîí CORS Error Detected: The API server needs to allow requests from this domain (${window.location.hostname}). Please contact the MountainShares team to configure CORS headers for buy.mountainshares.us`, 'error');
                    
                    // Provide fallback options
                    setTimeout(() => {
                        const fallbackDiv = document.createElement('div');
                        fallbackDiv.style.cssText = `
                            margin-top: 20px;
                            padding: 25px;
                            background: var(--glass-gradient);
                            backdrop-filter: blur(20px);
                            border-radius: 15px;
                            border: 1px solid var(--sky-blue);
                            text-align: center;
                        `;
                        fallbackDiv.innerHTML = `
                            <h4 style="color: var(--wv-gold); margin-bottom: 15px;">üîß Technical Issue - Alternative Options:</h4>
                            <p style="color: var(--mountain-white); margin-bottom: 20px; line-height: 1.6;">
                                The payment system is experiencing a technical issue. You can:
                            </p>
                            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                                <button onclick="copyPurchaseDetails()" style="padding: 12px 24px; background: var(--sky-blue); color: var(--mountain-dark); border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                                    üìã Copy Purchase Details
                                </button>
                                <button onclick="emailSupport()" style="padding: 12px 24px; background: var(--wv-gold); color: var(--mountain-dark); border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                                    üìß Email Support
                                </button>
                            </div>
                        `;
                        
                        const existingFallback = document.getElementById('fallback-options');
                        if (existingFallback) {
                            existingFallback.remove();
                        }
                        fallbackDiv.id = 'fallback-options';
                        document.querySelector('.purchase-form').appendChild(fallbackDiv);
                    }, 2000);
                } else {
                    showStatus(`‚ùå Purchase failed: ${error.message}`, 'error');
                }
            }
        }

        // Copy purchase details to clipboard
        function copyPurchaseDetails() {
            const pricing = calculatePrice();
            const details = `
MountainShares Purchase Request
==============================
Quantity: ${pricing.quantity} MountainShares
Wallet Address: ${connectedWallet}
Total Amount: ${pricing.totalAmount.toFixed(2)}

Breakdown:
- Token Value: ${pricing.tokenValue.toFixed(2)}
- Platform Fee: ${pricing.platformFee.toFixed(2)}
- Processing Fee: ${pricing.processingFee.toFixed(2)}
- Stripe Fee: ${pricing.stripeFee.toFixed(2)}

Requested from: ${window.location.href}
Timestamp: ${new Date().toISOString()}
            `.trim();

            navigator.clipboard.writeText(details).then(() => {
                showStatus('üìã Purchase details copied to clipboard!', 'success');
            }).catch(() => {
                showStatus('‚ùå Failed to copy to clipboard. Please manually copy the details.', 'error');
            });
        }

        // Email support with purchase details
        function emailSupport() {
            const pricing = calculatePrice();
            const subject = encodeURIComponent('MountainShares Purchase Support Request');
            const body = encodeURIComponent(`
Hello MountainShares Team,

I'm trying to purchase MountainShares but encountered a technical issue (CORS error) on buy.mountainshares.us.

Purchase Details:
- Quantity: ${pricing.quantity} MountainShares
- Wallet Address: ${connectedWallet}
- Total Amount: ${pricing.totalAmount.toFixed(2)}
- Browser: ${navigator.userAgent}
- Error: CORS policy blocking API request

Please assist with completing this purchase or provide alternative payment methods.

Thank you!
            `);
            
            window.open(`mailto:support@mountainshares.us?subject=${subject}&body=${body}`);
            showStatus('üìß Email support opened. Please send the email to get assistance.', 'info');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('purchaseButton').addEventListener('click', initiatePurchase);
            document.getElementById('quantity').addEventListener('input', calculatePrice);

            // Initialize pricing
            calculatePrice();

            // Add floating particles for visual enhancement
            for (let i = 0; i < 25; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 20) + 's';
                document.body.appendChild(particle);
            }

            console.log('üèîÔ∏è MountainShares Purchase Portal Loaded');
            console.log('üíé Ready for West Virginia digital currency transactions');
        });
    </script>
</body>
</html>
